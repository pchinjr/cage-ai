<html>
	<head>
		<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<title>Welcome Worshiper!</title>
	<head>
	<body>
		<div class="container">
		<div class="jumbotron" style="margin-top:10px">
			<h1 class="text-center">Welcome Worshiper</h1>
			<p class="lead text-center">Every day we must be the best we can be. Render your secrets unto Cage and he will deliver.</p>
			<img class="img-responsive img-thumbnail center-block" src="http://cageme.herokuapp.com/random" style="max-height:300px"> </br>

			<input type="file" accept="images/*" onchange="encodeImageFileAsURL(this)"/>
			<output id="list"></output>	
			<div class="btn btn-primary" id="photoUpload">Send to Server</div>

			<p class="text-center"><strong>Our Father</strong>, which art in  Snake Eyes,</br> 
					Nicolas be thy name;</br>  
					thy  Face/Off come;</br>  
					thy Con-Air be done,</br>  
					in earth as it is in Deadfall.</br>  
					Give us this day our daily Ghost Rider.</br>  
					And forgive him for Trespass,</br>  
					as we forgave him for Windtalkers.</br>  
					And lead us not into Adaptation.;</br>  
					but deliver us from The Rock.</br> 
					</br> 	
					For thine is the Wicker Man,</br>  
					the National Treasure,</br>  
					for ever and ever.</br>  
					Amen.</br> 
			</p>
      </div>
	  </div>
		

<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script type="text/javascript">
	var result;
	var socket = io.connect('/');

	socket.on('connect', function(data) {
		socket.emit('public-join', {message: "public worshiper joined"});

		$('#photoUpload').on('click', function(){
			console.log('uploading image to server');
			socket.emit('sendFile', result);
		});

		socket.on('cageVerified', function(res){
			if (res === 'Nicolas Cage') {
				socket.emit('led:cage');
			} else if(res === 'NOPE') {
				alert("NOT HOLY ENOUGH");
			} else {
				alert("YOU ARE NOT FAITHFUL!!");
			}
		});
	});	
    
	//https://stackoverflow.com/questions/6150289/how-to-convert-image-into-base64-string-using-javascript
	function encodeImageFileAsURL(element) {
		var file = element.files[0];
		var reader = new FileReader();
		reader.onloadend = function() {
			//console.log('RESULT', reader.result)
			result = reader.result;
			console.log('done encoding file');
		};
		reader.readAsDataURL(file);
	};
		
</script>
</body>
</html>